/**
 * Модерация постов: чёрный список запрещённых слов.
 * Проверяются заголовок и тело поста при создании, редактировании и публикации.
 */
(function(){
  // Слова в нижнем регистре, проверка через границы слова (\b) и без учёта регистра
  var MODERATION_BLACKLIST = [
    // Мат и грубые оскорбления
    'блядь','блядина','блядство','блядун','блядюга','блядюк','блядюга','бля','блять',
    'сука','сучка','суки','сучёнок','сучара',
    'хуй','хуя','хуе','хуи','хуёв','хуев','хуйло','хуйня','хуярить','нахер','нахрен',
    'пизда','пизде','пизду','пизды','пиздой','пиздюк','пиздюля','пиздятина','пиздоблядь',
    'ебал','ебать','ебаная','ебаный','ебанутый','ебанько','ебанат','ебанул','ебанёшь',
    'ёбаный','ёбаная','ёбнул','ёбнуться','ёб','ёба','ёбнул','ёбнутый',
    'жопа','жопу','жопой','жопе','жопка','жопник',
    'дерьмо','дерьма','дерьмом','дерьмище',
    'гавно','говно','говна','говном','говнюк','говнодав',
    'мудак','мудила','мудозвон','мудёж','мудачина',
    'долбоёб','долбоящер','долбоящер','далбоёб',
    'уёбок','уёбище','уебан','уёбище','уебок',
    'залупа','залупу','залупой','залупиться',
    'мразь','мразота','мразь','мразюга',
    'падла','падлюка','падло','падла','падлюга',
    'тварь','тварюга','твари','тварюга',
    'сволочь','сволочи','сволочной','сволочь',
    // Политика и рознь
    'нацист','нацизм','фашист','фашизм','расист','расизм','ксенофоб',
    'геноцид','экстремист','экстремизм','сепаратист','сепаратизм',
    'холокост','наци','нацики','фашики','рассисты',
    // Религиозная рознь
    'жид','жиды','жидовский','жидовство','хачик','хачи','черножопые','черножопый',
    'кафыр','кафир','неверные','гяур','гяуры','джихад','шахид',
    // Другое
    'наркотик','кокаин','героин','метамфетамин','амфетамин','спайс','соль','трава',
    'дозу','доза','дозу','колоться','вмазываться'
  ];

  function normalize(s) {
    if (!s || typeof s !== 'string') return '';
    return s.toLowerCase().replace(/ё/g, 'е').replace(/ъ/g, 'ь');
  }

  function checkModeration(text) {
    if (!text || typeof text !== 'string') return { ok: true, words: [] };
    var norm = normalize(text);
    var found = [];
    for (var i = 0; i < MODERATION_BLACKLIST.length; i++) {
      var w = MODERATION_BLACKLIST[i];
      var re = new RegExp('\\b' + w.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'i');
      if (re.test(norm) || norm.indexOf(w) >= 0) found.push(w);
    }
    return { ok: found.length === 0, words: found };
  }

  function checkPostModeration(title, body) {
    var t = checkModeration(title || '');
    var b = checkModeration(body || '');
    var words = [];
    if (!t.ok) words = words.concat(t.words);
    if (!b.ok) words = words.concat(b.words);
    var seen = {};
    words = words.filter(function(w) { if (seen[w]) return false; seen[w] = true; return true; });
    return { ok: words.length === 0, words: words };
  }

  window.BizForum = window.BizForum || {};
  window.BizForum.moderation = { checkModeration: checkModeration, checkPostModeration: checkPostModeration };
})();
